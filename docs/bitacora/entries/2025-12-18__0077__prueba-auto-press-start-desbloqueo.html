<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba: Auto-Press de Start para Desbloqueo - Viboy Color Bit谩cora</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
    <div class="container">
        <!-- Aviso Clean-Room -->
        <div class="clean-room-notice">
            <strong>锔 Clean-Room / Educativo</strong>
            <p>Este proyecto es educativo y Open Source. No se copia c贸digo de otros emuladores. Implementaci贸n basada 煤nicamente en documentaci贸n t茅cnica y tests permitidas.</p>
        </div>

        <!-- Header -->
        <header>
            <h1>Prueba: Auto-Press de Start para Desbloqueo</h1>
            <div class="meta">
                <span class="meta-item">
                    <strong>Fecha:</strong> 2025-12-18
                </span>
                <span class="meta-item">
                    <strong>Step ID:</strong> 0077
                </span>
                <span class="meta-item">
                    <strong>Estado:</strong> <span class="tag tag-draft">Draft</span>
                </span>
            </div>
            <nav>
                <ul>
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="2025-12-18__0076__diagnostico-timer-tac-interrupciones.html">Anterior</a></li>
                    <li><a href="#">Siguiente</a></li>
                </ul>
            </nav>
        </header>

        <!-- Main Content -->
        <main>
            <!-- 1. Resumen -->
            <section id="resumen">
                <h2>Resumen</h2>
                <p>
                    Se a帽adi贸 una prueba experimental de pulsaci贸n autom谩tica del bot贸n Start despu茅s de 2 segundos de ejecuci贸n para intentar desbloquear el juego que est谩 congelado en el logo de Game Freak. La hip贸tesis es que muchos juegos se quedan esperando en pantallas de logo hasta que el usuario pulsa un bot贸n, y si el emulador no simula esta entrada, el juego se queda bloqueado.
                </p>
                <p>
                    Esta es una prueba de diagn贸stico, no una implementaci贸n final. Si funciona, confirmar谩 que el problema es la falta de input del usuario. Si no funciona, indicar谩 que hay un bug m谩s profundo en la CPU o en el manejo de interrupciones.
                </p>
            </section>

            <!-- 2. Concepto de Hardware -->
            <section id="concepto-hardware">
                <h2>Concepto de Hardware</h2>
                <p>
                    Muchos juegos de Game Boy muestran el logo de la empresa desarrolladora o del fabricante y se quedan esperando hasta que el usuario pulsa un bot贸n (generalmente Start o A) o hasta que pasa un tiempo determinado (gestionado por V-Blanks).
                </p>
                <p>
                    El Joypad de la Game Boy funciona con l贸gica Active Low: cuando un bot贸n se pulsa, su bit correspondiente en el registro P1 (0xFF00) se pone a 0. Cuando se detecta esta transici贸n (de soltado a pulsado), se solicita una interrupci贸n Joypad (Bit 4 de IF, 0xFF0F) con vector 0x0060.
                </p>
                <p>
                    Si el juego est谩 esperando una pulsaci贸n de bot贸n para avanzar, pero el usuario nunca pulsa nada (o el emulador no simula esta entrada), el juego se queda bloqueado en un bucle de espera.
                </p>
                <p>
                    <strong>Hip贸tesis de diagn贸stico:</strong> Si el juego est谩 en un bucle esperando input del Joypad, simular una pulsaci贸n de Start despu茅s de 2 segundos deber铆a desbloquear el juego y permitir que avance. Si no funciona, el problema est谩 en otro lugar (CPU, interrupciones, etc.).
                </p>
                <p>
                    <em>Fuente: Pan Docs - Joypad Input</em>
                </p>
            </section>

            <!-- 3. Implementaci贸n -->
            <section id="implementacion">
                <h2>Implementaci贸n</h2>
                <p>
                    Se a帽adi贸 l贸gica en el m茅todo <code>run()</code> de <code>src/viboy.py</code> para simular una pulsaci贸n autom谩tica del bot贸n Start despu茅s de 2 segundos de ejecuci贸n, y soltarlo 0.2 segundos despu茅s.
                </p>
                
                <h3>Cambios realizados</h3>
                <p>
                    Se a帽adieron dos variables al inicio del bucle principal:
                </p>
                <ul>
                    <li><code>start_time</code>: Tiempo de inicio de la ejecuci贸n (usando <code>time.time()</code>)</li>
                    <li><code>auto_start_pressed</code>: Flag para rastrear si ya se presion贸 Start (evitar m煤ltiples pulsaciones)</li>
                </ul>
                <p>
                    Dentro del bucle principal, se a帽adi贸 la siguiente l贸gica:
                </p>
                <pre><code># PRUEBA: Auto-press de Start despu茅s de 2 segundos
current_time = time.time()
if not auto_start_pressed and current_time - start_time > 2.0:
    logger.info(" AUTO-PRESS: Pulsando START para desbloquear...")
    if self._joypad is not None:
        self._joypad.press("start")
    auto_start_pressed = True
if auto_start_pressed and current_time - start_time > 2.2:
    if self._joypad is not None:
        self._joypad.release("start")</code></pre>
                <p>
                    Esto hace que:
                </p>
                <ul>
                    <li>A los 2 segundos: Se presiona Start autom谩ticamente y se muestra un mensaje en el log.</li>
                    <li>A los 2.2 segundos: Se suelta Start.</li>
                    <li>La pulsaci贸n solo ocurre una vez (controlada por <code>auto_start_pressed</code>).</li>
                </ul>
                <p>
                    El m茅todo <code>press()</code> del Joypad ya maneja correctamente:
                </p>
                <ul>
                    <li>Detectar la transici贸n de soltado a pulsado.</li>
                    <li>Solicitar la interrupci贸n Joypad (Bit 4 de IF) cuando se pulsa un bot贸n.</li>
                    <li>Logging de la acci贸n.</li>
                </ul>
            </section>

            <!-- 4. Archivos Tocados -->
            <section id="archivos">
                <h2>Archivos Afectados</h2>
                <ul>
                    <li><code>src/viboy.py</code> - A帽adida l贸gica de auto-press de Start despu茅s de 2 segundos en el m茅todo <code>run()</code></li>
                    <li><code>docs/bitacora/entries/2025-12-18__0077__prueba-auto-press-start-desbloqueo.html</code> - Nueva entrada de bit谩cora</li>
                    <li><code>docs/bitacora/index.html</code> - Actualizado con la nueva entrada</li>
                    <li><code>docs/bitacora/entries/2025-12-18__0076__diagnostico-timer-tac-interrupciones.html</code> - Actualizado enlace "Siguiente"</li>
                    <li><code>INFORME_COMPLETO.md</code> - A帽adida entrada del paso 0077</li>
                </ul>
            </section>

            <!-- 5. Tests y Verificaci贸n -->
            <section id="tests">
                <h2>Tests y Verificaci贸n</h2>
                <p>
                    Esta es una prueba de diagn贸stico experimental. La verificaci贸n se realizar谩 ejecutando el juego y observando si avanza despu茅s de la pulsaci贸n autom谩tica de Start.
                </p>
                <ul>
                    <li><strong>Comando de ejecuci贸n:</strong> <code>python main.py pkmn.gb</code></li>
                    <li><strong>Entorno:</strong> Windows / Python 3.10+</li>
                    <li><strong>Qu茅 buscar en los logs:</strong>
                        <ul>
                            <li><code> AUTO-PRESS: Pulsando START para desbloquear...</code>: Confirma que la pulsaci贸n autom谩tica se ejecut贸.</li>
                            <li><code>Joypad: Interrupci贸n solicitada por 'start'</code>: Confirma que se solicit贸 la interrupci贸n Joypad.</li>
                            <li>Si el juego avanza despu茅s de 2 segundos: La prueba es exitosa, el problema era la falta de input del usuario.</li>
                            <li>Si el juego sigue congelado: El problema est谩 en otro lugar (CPU, interrupciones, etc.).</li>
                        </ul>
                    </li>
                </ul>
                <p>
                    <strong>Estado:</strong> Pendiente de ejecuci贸n y observaci贸n.
                </p>
                <p>
                    <strong>Nota:</strong> Esta es una prueba de diagn贸stico, no una soluci贸n final. Si funciona, se puede considerar implementar una opci贸n de configuraci贸n para permitir/desactivar este comportamiento, o simplemente documentar que el usuario debe pulsar Start manualmente.
                </p>
            </section>

            <!-- 6. Fuentes Consultadas -->
            <section id="fuentes">
                <h2>Fuentes Consultadas</h2>
                <ul>
                    <li>Pan Docs: <a href="https://gbdev.io/pandocs/Joypad_Input.html">Joypad Input</a></li>
                    <li>Pan Docs: <a href="https://gbdev.io/pandocs/Interrupts.html">Interrupts</a></li>
                </ul>
            </section>

            <!-- 7. Integridad Educativa -->
            <section id="integridad">
                <h2>Integridad Educativa</h2>
                <div class="integridad">
                    <h3>Lo que Entiendo Ahora</h3>
                    <ul>
                        <li><strong>Pantallas de Logo:</strong> Muchos juegos se quedan en pantallas de logo esperando input del usuario o un tiempo determinado antes de avanzar al men煤 principal.</li>
                        <li><strong>Interrupci贸n Joypad:</strong> Cuando un bot贸n se pulsa, se solicita una interrupci贸n Joypad (Bit 4 de IF) con vector 0x0060. Si el juego est谩 esperando esta interrupci贸n, no avanzar谩 hasta que ocurra.</li>
                        <li><strong>Diagn贸stico sistem谩tico:</strong> Al simular una pulsaci贸n de Start autom谩ticamente, podemos determinar si el problema es la falta de input del usuario o un bug m谩s profundo en la CPU/interrupciones.</li>
                    </ul>

                    <h3>Lo que Falta Confirmar</h3>
                    <ul>
                        <li><strong>驴El juego est谩 esperando input del Joypad?</strong> Necesitamos ejecutar el juego y ver si avanza despu茅s de la pulsaci贸n autom谩tica de Start.</li>
                        <li><strong>驴La interrupci贸n Joypad se dispara correctamente?</strong> Necesitamos verificar que el log muestra la interrupci贸n solicitada.</li>
                        <li><strong>驴Hay un bug en el manejo de interrupciones Joypad?</strong> Si la pulsaci贸n no desbloquea el juego, puede haber un problema en c贸mo se maneja la interrupci贸n.</li>
                    </ul>

                    <h3>Hip贸tesis y Suposiciones</h3>
                    <p>
                        <strong>Hip贸tesis principal:</strong> El juego se congela porque est谩 esperando una pulsaci贸n de bot贸n que nunca llega. Simular una pulsaci贸n de Start deber铆a desbloquear el juego.
                    </p>
                    <p>
                        <strong>Suposici贸n:</strong> La implementaci贸n del Joypad y la interrupci贸n Joypad son correctas. Si la pulsaci贸n autom谩tica no funciona, el problema est谩 en otro lugar (bucle infinito en CPU, bug en el manejo de interrupciones, etc.).
                    </p>
                </div>
            </section>

            <!-- 8. Pr贸ximos Pasos -->
            <section id="proximos-pasos">
                <h2>Pr贸ximos Pasos</h2>
                <ul>
                    <li>[ ] Ejecutar <code>python main.py pkmn.gb</code> y observar si el juego avanza despu茅s de 2 segundos</li>
                    <li>[ ] Verificar que aparece el mensaje <code> AUTO-PRESS: Pulsando START para desbloquear...</code> en los logs</li>
                    <li>[ ] Si funciona: Confirmar que el problema era la falta de input del usuario. Considerar implementar una opci贸n de configuraci贸n o documentar el comportamiento esperado.</li>
                    <li>[ ] Si no funciona: Continuar el diagn贸stico en otras direcciones (CPU, interrupciones, etc.). El problema no es la falta de input del usuario.</li>
                </ul>
            </section>
        </main>

        <!-- Footer -->
        <footer>
            <p><strong>Viboy Color</strong> - Emulador educativo de Game Boy Color</p>
            <p>Proyecto Open Source - Clean-Room Implementation</p>
            <p>No se copia c贸digo de otros emuladores. Basado 煤nicamente en documentaci贸n t茅cnica.</p>
        </footer>
    </div>
</body>
</html>

